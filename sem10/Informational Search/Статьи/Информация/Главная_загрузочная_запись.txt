Главная загрузочная запись (англ. master boot record, MBR) — код и данные, необходимые для последующей загрузки операционной системы и расположенные в первых физических секторах (чаще всего в самом первом) на жёстком диске или другом устройстве хранения информации.
Применялась с 1983 года (начиная с PC DOS 2.0) до широкого внедрения UEFI и схемы GPT в 2010-х.
MBR содержит небольшой фрагмент исполняемого кода, таблицу разделов диска (англ. partition table) и специальную сигнатуру.
Функция MBR — «переход» в тот раздел жёсткого диска, с которого следует исполнять «дальнейший код» (обычно — загружать ОС). На «стадии MBR» происходит выбор раздела диска, загрузка кода ОС (происходит на более поздних этапах алгоритма).
В процессе запуска компьютера, после окончания начального теста (Power-on self-test — POST), Базовая система ввода-вывода (BIOS) загружает «код MBR» в оперативную память (в IBM PC обычно с адреса 0000:7c00) и передаёт управление находящемуся в MBR загрузочному коду.

Роль и место MBR в загрузке компьютера (для архитектуры x86)
В процессе загрузки компьютера x86 вначале всегда отрабатывается BIOS. На этой стадии, кроме тестирования и инициализации оборудования компьютера, происходит также и выбор устройства, с которого будет происходить дальнейшая загрузка. Это может быть дискета, жёсткий диск, сетевой ресурс, встроенное ПЗУ или любое иное устройство (алгоритм выбора загрузочного устройства может быть различным и зависит от реализации BIOS). После выбора загрузочного устройства BIOS полностью передаёт этому устройству управление всей дальнейшей загрузкой.
В случае, если устройство имеет только один раздел (как, например, дискета или сетевая загрузка), то выбор однозначен, и загрузка продолжается сразу с этого устройства. Однако, если устройство содержит несколько разделов, каждый из которых потенциально может быть загрузочным (как, например, в случае жёстких дисков), то возникает неопределённость: с какого именно раздела производить загрузку. Для разрешения неоднозначности по выбору раздела было предложено вынести этот вопрос из ве́дения BIOS и передать этот выбор самому устройству. Возникла идея использовать для этого небольшую программу, записанную на самом носителе, которая и осуществляла бы данный выбор. Так появилась концепция MBR.
Таким образом, потенциальное наличие нескольких загрузочных разделов, среди которых необходимо осуществить выбор — это ключевой момент в необходимости появления и отработки MBR. Для устройств с единственным (или однозначно заданным) загрузочным разделом концепция MBR лишена смысла и не используется.

Развитие MBR
Иногда в MBR кроме основной функции (выбора раздела) включаются также и другие функции, например, авторизация. Но это уже расширение и дополнение к основной функции и задаче MBR. Такие системы не получили широкого распространения.

Другие (не x86) системы
В связи с тем, что на других системах применяются иные архитектурные решения (начиная от активации «железа» и заканчивая загрузкой ОС), концепция MBR может быть к ним неприменима.

Стандартизация MBR
Утверждённого стандарта на структуру MBR не существует, однако, есть «сложившиеся традиции», которых придерживаются большинство MBR от разных производителей.

Наиболее распространённый формат MBR
Иные форматы MBR
Загрузчики, отличные от стандартных Windows-загрузчиков, могут использовать всё пространство между MBR и первым разделом (около 32 кБ; 1-й–63-й секторы) для собственных целей. В таких случаях под MBR понимают весь загрузочный код, а для выделения именно первых 512 байт говорят, что они расположены в MBS (Master Boot Sector) — главном загрузочном секторе.
Для операционных систем Microsoft понятия MBR и MBS совпадают, так как вся MBR содержится в MBS, хотя это не совсем правильно, так как под MBR подразумевают данные, а под MBS — физический сектор.

Алгоритм загрузки компьютера с использованием MBR
BIOS (до MBR)
BIOS проводит начальную инициализацию оборудования (POST).
BIOS определяет, с какого устройства производить дальнейшую загрузку: дискета, флеш-накопитель, жёсткий диск и т. д. (выбор устройства зависит от версии и от настроек BIOS)[в данном описании рассматривается только случай загрузки с жёсткого диска].BIOS считывает один сектор (512 байт), т.е. непосредственно MBR, который находится по адресу: «цилиндр 0, головка 0, сектор 1», и помещает его в область памяти по физическому адресу 0x7C00.
BIOS проверяет, что этот сектор оканчивается сигнатурой 55ААh[если это не так, то управление возвращается обратно в BIOS].BIOS передаёт управление по физическому адресу 0x7C00 (то есть сектору MBR), предварительно записав в регистр DL номер диска, с которого этот сектор считан. Для первого жёсткого диска это значение будет равно 80h (128 в десятичной системе), для дисковода A: равно 0. Кроме того, Plug-n-Play BIOS может записать в регистры ES:DI указатель на структуру «$PnP».

MBR
Вообще говоря, код в MBR может делать что угодно, в рамках ограничений по размеру. Обычно происходит следующее, но бывают и исключения. Например, код, записываемый в MBR при установке загрузчика GNU GRUB, не анализирует флаги активности разделов и передает управление не загрузчику какого-либо раздела, а основному образу GRUB.
Выбор загрузочного раздела и проверка целостности MBR:

MBR копирует себя на другой адрес, чтобы освободить место для загрузчика ОС (к примеру MBR фирмы Microsoft копирует себя на адрес 0000:0600).
MBR просматривает по очереди все записи о разделах и ищет первую запись об «активном» («загрузочном») разделе (то есть ищет раздел, отмеченный как 80h).
В случае успеха (раздел, помеченный как 80h — найден) MBR запоминает номер этого раздела[если просмотрены все 4 записи и не найден раздел, помеченный как 80h, то вызывается INT 18h (отображается сообщение об ошибке посредством вызова BIOS программного прерывания 18h). Это возвращает управление обратно в BIOS, что может приводить либо к загрузке BASIC, либо к повторной попытке загрузить систему с диска, либо к перезагрузке компьютера — в зависимости от версии и реализации BIOS].MBR просматривает все оставшиеся записи и проверяет, что это единственный активный раздел (что больше разделов, помеченных 80h, на данном физическом диске не существует). Если находятся другие разделы, помеченные 80h (и/или хотя бы один раздел содержит неправильную метку), то MBR выводит сообщение об ошибке (обычно это что-то типа «Invalid partition table»), после чего система зависает в бесконечном цикле, из которого можно выйти только перезагрузкой компьютера.На этом заканчивается проверка MBR и начинается подготовка к загрузке ОС:

MBR считывает первый сектор логического диска (VBR — Volume Boot Record, или Volume Boot Sector), помеченного как «загрузочный» (80h), и помещает этот сектор по физическому адресу 0x7C00.
MBR проверяет, что данный сектор заканчивается сигнатурой 55AAh[если этой сигнатуры в этом месте нет, то выводится сообщение «Missing operating system» и компьютер подвисает, требуется перезагрузка].MBR передаёт управление загрузочному сектору выбранного раздела диска.

Загрузочный сектор логического диска (VBR) (после MBR)
Загрузочный сектор зависит от типа файловой системы на логическом разделе диска и содержит код, выполняющий нахождение и загрузку собственно операционной системы на данном типе файловой системы.

Структура MBR
Код загрузчика
После завершения процедуры POST в ОЗУ по физическому адресу 0x7C00 записывается код загрузчика (первые 446 байт из нулевого сектора диска), после чего ему передаётся управление. Задача этого кода — проанализировать таблицу разделов жёсткого диска, затем передать управление второму загрузочному коду, который может находиться или в начале активного раздела, или на специальной области диска (эта область не занята файловыми системами, и обычно является группой секторов №1–№63, разделы на диске обычно начинаются с сектора №64). Второй загрузчик уже умеет читать хотя бы одну файловую систему, и его задача - передать управление файлам из файловой системы ОС для запуска ОС.
Примеры:
Загрузчик Windows поступает первым способом: он передает управление второму загрузчику, который находится в начале активного Windows раздела. Далее второй загрузчик обеспечивает поддержку файловой системы и запускает необходимые файлы для дальнейшей загрузки ОС.
Загрузчик GRUB (нашедший популярность в Linux дистрибутивах) использует второй способ: он передает управление второму загрузчику, который расположен в группе секторов №1-№63. Второй загрузчик ищет корневой linux раздел, а на этом разделе ищет файлы конфигурации GRUB (и модули GRUB) для отображения GRUB меню. При выборе какого-либо пункта в GRUB меню, GRUB действует согласно файлу конфигурации для этого пункта (например, в случае с дистрибутивами linux в ОЗУ копируется linux ядро с initrd, и управление передается ядру). Копия первого загрузчика GRUB (446 байт из нулевого сектора диска) находится в файле boot.img, а копия второго загрузчика GRUB (группа секторов №1 - №63) находится в файле core.img (собирается при установке GRUB с учетом файловой системы корневого раздела и других факторов)

Таблица разделов
В таблице разделов хранится информация о типе раздела и его расположении на жёстком диске.

Сигнатура
Последние два байта MBR называются сигнатурой. Значение этих байтов должно быть 55h AAh. В случае, если это не так, запись считается некорректной.

Структура описания раздела
Признак активности разделов
Признак активности раздела — признак, обозначающий возможность загрузки операционной системы с данного раздела. Для стандартных загрузчиков может принимать следующие значения:

80h — раздел является активным;
00h — раздел является неактивным;
другие значения являются ошибочными и игнорируются.

Начало раздела / Конец раздела
Координаты начала и конца раздела в CHS-формате (цилиндр, головка, сектор). CHS не позволяет выполнять адресацию более чем к 7,8 ГБ данных, и для адресации к разделам, находящимся за пределами 7,8 ГБ, используется LBA-адресация.

Код типа раздела
Код файловой системы, используемой на данном разделе.

В случае, если используется расширенный раздел, то координаты начала раздела указывают на EBR.

Формат указателей аналогичен MBR.

Смещение первого сектора
Координаты начала раздела в LBA-координатах. Позволяет выполнять адресацию до 2 ТБ данных.

Восстановление MBR
Если каким-либо образом была потеряна MBR, то её можно восстановить специальными утилитами (например, TestDisk), которая «просмотрит» весь носитель информации и создаст таблицу разделов.
Пример кода создания резервной копии MBR в unix-подобных системах для диска sda:

dd if=/dev/sda of=mbr.bin bs=512 count=1

Восстановление загрузчика и таблицы разделов:

dd if=mbr.bin of=/dev/sda bs=512 count=1

Восстановление только загрузчика:

dd if=mbr.bin of=/dev/sda bs=446 count=1

См. также
Логический диск
Файловая система
Раздел диска
Загрузчик операционной системы
Загрузочный сектор
Начальная загрузка компьютера
GUID (таблица разделов)
Расширенная загрузочная запись (EBR)

Пояснения
Примечания
Ссылки

KB114841 (неопр.). Microsoft Windows XP Support/ Windows NT Boot Process and Hard Disk Constraints.  Microsoft Knowledge Base. Дата обращения 27 декабря 2015.
MBR своими руками
Главная загрузочная запись — Master Boot Record (MBR)
Восстановление MBR
Спецификация «BIOS Boot Specification» от Intel, Phoenix, Compaq  (англ.)
Вирус в загрузочном секторе MBR.Lock и способы восстановления
GPT vs MBR